// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String
  role          String    @default("user") // admin, manager, user
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  assignments   DriverAssignment[]
}

model Vehicle {
  id                String              @id @default(cuid())
  name              String
  make              String
  model             String
  year              Int
  licensePlate      String              @unique
  vin               String              @unique
  status            String              @default("active") // active, maintenance, retired
  fuelType          String
  mileage           Float               @default(0)
  lastServiceDate   DateTime?
  nextServiceDate   DateTime?
  purchaseDate      DateTime
  purchasePrice     Float
  imageUrl          String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  assignments       DriverAssignment[]
  maintenanceRecords MaintenanceRecord[]
  trips             Trip[]
}

model DriverAssignment {
  id          String    @id @default(cuid())
  vehicleId   String
  userId      String
  startDate   DateTime
  endDate     DateTime?
  status      String    @default("active") // active, completed
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  vehicle     Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
  @@index([userId])
}

model MaintenanceRecord {
  id            String    @id @default(cuid())
  vehicleId     String
  type          String    // routine, repair, inspection
  description   String
  cost          Float
  mileage       Float
  serviceDate   DateTime
  servicedBy    String
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  vehicle       Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
}

model Trip {
  id            String    @id @default(cuid())
  vehicleId     String
  driverId      String
  startDate     DateTime
  endDate       DateTime?
  startMileage  Float
  endMileage    Float?
  startLocation String
  endLocation   String?
  purpose       String
  status        String    @default("in_progress") // in_progress, completed
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  vehicle       Vehicle   @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
  @@index([driverId])
}
